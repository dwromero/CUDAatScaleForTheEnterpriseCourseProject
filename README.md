# SE(2) x S Image Transformations using NVIDIA NPP with CUDA

## Overview

This project demonstrates the use of NVIDIA Performance Primitives (NPP) library with CUDA to perform SE(2) x S image transformations on **grayscale images**. The goal is to utilize GPU acceleration to efficiently apply rotation, scaling, and translation transformations to 8-bit single-channel (grayscale) images. SE(2) represents the Special Euclidean group in 2D (rotation and translation), and S represents scaling operations. This combination allows for comprehensive geometric transformations leveraging the computational power of modern GPUs. This project is an example of advanced image processing operations using CUDA and NPP.

**⚠️ Important Note: This implementation currently supports only grayscale (single-channel) images due to the NPP utility function limitations.**

## Code Organization

```bin/```
Contains the compiled binary executable, `imageTransformNPP`, generated after building the project.

```data/```
Contains the sample grayscale image, `Lena_gray.png`, used for running the transformation demonstrations.

```src/```
The source code is placed here.

```outputs/```
This folder contains the output files generated by the image transformation program. Includes:
- PGM format output files (primary output format)
- `convert_pgm_to_png.py` - Python script for converting PGM files to PNG format
- `png_outputs/` - Subdirectory containing PNG converted files

```Makefile```
File describing how to compile and run.

## Key Concepts

Performance Strategies, Image Processing, NPP Library, Geometric Transformations, SO(2) Group Theory, Scaling Transformations

## Supported OSes

Only tested on Linux.

## Supported CPU Architecture

x86_64, ppc64le, armv7l -- only tested on x86_64.

## Installation

Follow these steps to set up the environment, install dependencies, and build the project.

### 1. Initialize Submodules

This project uses Git submodules to include helper code from the NVIDIA CUDA Samples. After cloning the repository, you must initialize and update them:

```bash
git submodule init
git submodule update
```

### 2. Install Dependencies

#### CUDA Toolkit
Download and install the [CUDA Toolkit](https://developer.nvidia.com/cuda-downloads) (version 11.4 or later) for your platform. The NVIDIA Performance Primitives (NPP) library, a core dependency, is included with the toolkit.

#### FreeImage Library
The FreeImage library is required for image I/O operations.

- **On Debian/Ubuntu-based systems**, you can install it using `apt-get`:
  ```bash
  sudo apt-get update
  sudo apt-get install libfreeimage-dev
  ```
- **For other operating systems**, please visit the [FreeImage website](https://freeimage.sourceforge.io/) for download and installation instructions.

Once the prerequisites are installed, you can build the project.

## Image Format Requirements

**This project only supports grayscale (single-channel) images.** The supported image formats are:

- **Input**: Grayscale PNG, PGM, or other FreeImage-supported grayscale formats
- **Output**: Grayscale PGM format
- **Bit depth**: 8-bit unsigned integer (0-255)
- **Channels**: Single channel (C1) grayscale images only

**Converting Color Images to Grayscale:**
If you have color images, you need to convert them to grayscale first. You can use tools like:
- ImageMagick: `convert input.png -colorspace Gray output_gray.png`
- Python PIL: `Image.open('input.png').convert('L').save('output_gray.png')`
- GIMP: Image → Mode → Grayscale

The provided sample image `data/Lena_gray.png` is already in the correct grayscale format.

## Build and Run

### Linux
The project is built using the provided `Makefile`. After completing the installation steps, simply run `make`:
```bash
make all
```
or simply:
```bash
make
```
This command compiles the source code and creates the executable in the `bin/` directory.

The samples makefiles can take advantage of certain options:
*  **TARGET_ARCH=<arch>** - cross-compile targeting a specific architecture. Allowed architectures are x86_64, ppc64le, armv7l.
    By default, TARGET_ARCH is set to HOST_ARCH. On a x86_64 machine, not setting TARGET_ARCH is the equivalent of setting TARGET_ARCH=x86_64.<br/>
`$ make TARGET_ARCH=x86_64` <br/> `$ make TARGET_ARCH=ppc64le` <br/> `$ make TARGET_ARCH=armv7l` <br/>
    See [here](http://docs.nvidia.com/cuda/cuda-samples/index.html#cross-samples) for more details.
*   **dbg=1** - build with debug symbols
    ```
    $ make dbg=1
    ```
*   **SMS="A B ..."** - override the SM architectures for which the sample will be built, where `"A B ..."` is a space-delimited list of SM architectures. For example, to generate SASS for SM 50 and SM 60, use `SMS="50 60"`.
    ```
    $ make SMS="50 60"
    ```

*  **HOST_COMPILER=<host_compiler>** - override the default g++ host compiler. See the [Linux Installation Guide](http://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#system-requirements) for a list of supported host compilers.
```
    $ make HOST_COMPILER=g++
```

## Running the Program

### Quick Start with Make Targets
After building the project, you can run the program using several convenient make targets. All targets use the provided grayscale sample image:

```bash
# Default: 45° rotation, 1.0 scale
make run

# Demo: 45° rotation with 1.5x scaling  
make run-demo

# SE(2) Demo: 30° rotation, 1.2x scaling, and (50, -25) translation
make run-se2-demo

# Rotation only: 90° rotation, no scaling
make run-rotate

# Scaling only: 2x scaling, no rotation
make run-scale

# Run all previous demos
make run-all-demos

# Convert all PGM files to PNG format
make convert-to-png
```

These commands will automatically use `data/Lena_gray.png` as input and save results to the `outputs/` directory in PGM format.

**Note:** To convert the resulting PGM files to PNG format for easier viewing, use the provided conversion script: `cd outputs && python convert_pgm_to_png.py`

### Direct Binary Execution
If you wish to run the binary directly with custom input/output files and transformation parameters, you can use:

```bash
./bin/imageTransformNPP --input data/Lena_gray.png --output outputs/Lena_transformed.pgm --rotation 45 --scale 1.5
```

**Important:** Ensure your input image is in grayscale format before running the program.

### Transformation Parameters

- `--rotation <angle>`: Rotation angle in degrees (default: 45)
- `--scale <factor>`: Scaling factor (default: 1.0, values > 1.0 enlarge, < 1.0 shrink)
- `--input <path>`: Input grayscale image file path
- `--output <path>`: Output grayscale image file path (saved as .pgm format)

**Note:** Arguments can be specified in two formats: `--option=value` or `--option value`

**Note:** Input images must be in grayscale format and output images are automatically saved in PGM format. The program will fail if a color image is provided as input.

### Advanced Example Usage

All examples below use the provided grayscale image `data/Lena_gray.png`:

```bash
# Apply 30-degree rotation with 2x scaling
./bin/imageTransformNPP --input=data/Lena_gray.png --output=outputs/result.pgm --rotation 30 --scale 2.0

# Apply 90-degree rotation with 0.5x scaling (shrink)
./bin/imageTransformNPP --input=data/Lena_gray.png --output=outputs/result.pgm --rotation 90 --scale 0.5

# Apply SE(2) transformation: 60-degree rotation, 0.8x scaling, and translation by (100, 50)
./bin/imageTransformNPP --input=data/Lena_gray.png --output=outputs/result_se2.pgm --rotation 60 --scale 0.8 --tx 100 --ty 50

# Apply only rotation (no scaling)
./bin/imageTransformNPP --input=data/Lena_gray.png --output=outputs/result.pgm --rotation 180 --scale 1.0
```

**Remember:** Replace `data/Lena_gray.png` with your own grayscale image file path if using different input images.

## Converting PGM to PNG

Since the program outputs grayscale images in PGM format, a Python conversion script is provided to convert these files to PNG format for easier viewing and sharing.

### PNG Conversion Script

The `outputs/convert_pgm_to_png.py` script automatically converts all `.pgm` files in the `outputs/` directory to `.png` format and saves them in the `outputs/png_outputs/` subdirectory.

**Dependencies:**
- Python 3.x
- PIL (Pillow) library: `pip install Pillow`

**Usage:**
```bash
# Navigate to the outputs directory
cd outputs

# Run the conversion script
python3 convert_pgm_to_png.py
```

**Features:**
- Automatically finds all `.pgm` files in the outputs directory
- Converts each file to PNG format
- Saves PNG files in the `png_outputs/` subdirectory
- Replaces existing PNG files if they exist
- Provides detailed conversion progress and error reporting

**Example output:**
```
=== PGM to PNG Converter ===
Converting .pgm files to .png format...

Found 3 .pgm file(s) to convert:
  ✓ Converted: Lena_demo.pgm → png_outputs/Lena_demo.png
  ✓ Converted: Lena_rotated.pgm → png_outputs/Lena_rotated.png
  ✓ Converted: Lena_scaled.pgm → png_outputs/Lena_scaled.png

Conversion complete! Successfully converted 3 out of 3 files.
PNG files saved in: /path/to/outputs/png_outputs
```

## Cleaning Up
To clean up the compiled binaries and other generated files, run:

```bash
make clean
```

This will remove all files in the bin/ directory.
